[tool:pytest]
# Robust Pytest configuration for optimized test execution

# Test discovery and execution with parallel support
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Optimized execution options with parallel support and performance tuning
addopts =
    --strict-markers
    --strict-config
    --disable-warnings
    --tb=short
    -ra
    --cov=.
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-fail-under=30
    --asyncio-mode=auto
    --timeout=60
    --timeout-method=thread
    --maxfail=5
    --durations=10
    --durations-min=1.0
    -n=2
    --dist=loadscope

# Comprehensive markers for test categorization
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (may use external resources)
    e2e: End-to-end tests (full workflow)
    slow: Slow running tests
    flaky: Tests that may be unreliable
    api: Tests that use API clients
    file_ops: Tests that perform file operations
    network: Tests that require network access
    mock: Tests that use mock clients
    real_api: Tests that use real API calls
    asyncio: Async tests
    smoke: Quick smoke tests for critical functionality
    regression: Tests for bug fixes and regressions
    performance: Performance and scalability tests
    error_handling: Tests focused on error scenarios
    data_validation: Tests for data integrity and validation

# Test discovery settings
norecursedirs =
    .git
    __pycache__
    .pytest_cache
    archive
    node_modules
    .vscode
    .idea
    htmlcov
    .coverage

# Coverage configuration
[coverage:run]
source = .
omit =
    */tests/*
    */__pycache__/*
    */venv/*
    */.venv/*
    setup.py
    */test_framework.py
    */mocks/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod

# Filter warnings to reduce noise
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning
    ignore::pytest.PytestUnraisableExceptionWarning
    error::Exception

# Test result output
junit_family = xunit2
junit_logging = all

# Environment variables for robust testing with anti-hang protections
env =
    PYTHONPATH=.
    TEST_MODE=true
    MOCK_API=true
    TEST_USE_MOCK_API=true
    TEST_MOCK_DELAY=0.01
    TEST_API_PROVIDER=grok
    TEST_RUN_SLOW=false
    TEST_PARALLEL=false
    TEST_TEMP_DIR=/tmp/z-beam_test
    TEST_PROJECT_ROOT=.
    TEST_DISABLE_NETWORK=true
    TEST_TIMEOUT=25
    TEST_MAX_RETRIES=1
    TEST_FAIL_FAST=true
    TEST_MOCK_ALL_APIS=true
    TEST_BLOCK_REAL_API=true
