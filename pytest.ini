[tool:pytest]
# Robust Pytest configuration for reliable testing

# Test discovery and execution
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Test execution options with robust defaults
addopts =
    --strict-markers
    --strict-config
    --disable-warnings
    --tb=short
    -ra
    --cov=.
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-fail-under=80

# Comprehensive markers for test categorization
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (may use external resources)
    e2e: End-to-end tests (full workflow)
    slow: Slow running tests
    flaky: Tests that may be unreliable
    api: Tests that use API clients
    file_ops: Tests that perform file operations
    network: Tests that require network access
    mock: Tests that use mock clients
    real_api: Tests that use real API calls

# Test discovery settings
norecursedirs =
    .git
    __pycache__
    .pytest_cache
    archive
    node_modules
    .vscode
    .idea
    htmlcov
    .coverage

# Coverage configuration
[coverage:run]
source = .
omit =
    */tests/*
    */__pycache__/*
    */venv/*
    */.venv/*
    setup.py
    */test_framework.py
    */mocks/*

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod

# Filter warnings to reduce noise
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning
    ignore::pytest.PytestUnraisableExceptionWarning
    error::Exception

# Test result output
junit_family = xunit2
junit_logging = all

# Environment variables for robust testing
env =
    PYTHONPATH=.
    TEST_MODE=true
    MOCK_API=true
    TEST_USE_MOCK_API=true
    TEST_MOCK_DELAY=0.01
    TEST_API_PROVIDER=grok
    TEST_RUN_SLOW=false
    TEST_PARALLEL=false
    TEST_TEMP_DIR=/tmp/zbeam_test
    TEST_PROJECT_ROOT=.
