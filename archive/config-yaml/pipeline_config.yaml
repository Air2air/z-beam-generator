# Property Validation Pipeline Configuration
# Comprehensive configuration for the 7-stage material property validation system

metadata:
  version: "1.0.0"
  created_date: "2025-09-29"
  description: "Material Property Validation Pipeline Configuration"
  
# Quality thresholds for pipeline stages
quality_thresholds:
  completeness: 0.95      # 95% of required properties must have values
  accuracy: 0.90          # 90% accuracy against authoritative sources
  consistency: 0.85       # 85% internal consistency across related properties
  precision: 0.90         # 90% format compliance
  coverage: 1.0           # 100% material category coverage

# Research configuration
research_providers:
  - provider: "deepseek"
    priority: 1
    max_retries: 3
    timeout: 30
    confidence_weight: 0.4
    
  - provider: "claude"
    priority: 2
    max_retries: 2
    timeout: 25
    confidence_weight: 0.3
    
  - provider: "nist_database"
    priority: 1
    max_retries: 2
    timeout: 15
    confidence_weight: 0.3

# Validation rules
validation_rules:
  min_sources: 2                    # Minimum sources required for validation
  confidence_threshold: 0.7         # Minimum confidence for approval
  outlier_detection_method: "iqr"   # IQR, z-score, or isolation_forest
  outlier_threshold: 2.0            # Standard deviations for outlier detection
  cross_validation_required: true   # Require cross-validation
  expert_review_threshold: 0.6      # Below this confidence requires expert review

# Standardization rules
standardization_rules:
  unit_conversion:
    enabled: true
    target_units:
      density: "g/cm³"
      thermal_conductivity: "W/m·K"
      youngs_modulus: "GPa"
      tensile_strength: "MPa"
      hardness: "HV"
      temperature: "°C"
      thermal_expansion: "μm/m·°C"
      specific_heat: "J/kg·K"
      thermal_diffusivity: "mm²/s"
      
  naming_conventions:
    case_style: "camelCase"
    forbidden_characters: [" ", "-", "_", ".", "(", ")", "[", "]"]
    standardized_names:
      "density": "density"
      "melting_point": "meltingPoint"
      "melting point": "meltingPoint"
      "thermal_conductivity": "thermalConductivity"
      "thermal conductivity": "thermalConductivity"
      "youngs_modulus": "youngsModulus"
      "young's modulus": "youngsModulus"
      "tensile_strength": "tensileStrength"
      "tensile strength": "tensileStrength"
      
  value_formatting:
    numeric_precision:
      density: 3
      thermal_conductivity: 1
      youngs_modulus: 0
      temperature: 0
      default: 2
      
    range_format: "min-max"  # or "object" for {min: X, max: Y}
    confidence_scale: 100    # 0-100 or 0-1

# Stage-specific configurations
stage_configurations:
  stage1_discovery:
    scan_patterns:
      - "content/components/frontmatter/*.yaml"
      - "data/Categories.yaml"
      - "data/Materials.yaml"
    priority_weights:
      usage_frequency: 0.4
      completeness_gap: 0.3
      critical_properties: 0.3
    critical_properties:
      - "density"
      - "meltingPoint"
      - "thermalConductivity"
      - "hardness"
      - "youngsModulus"
      
  stage2_standardization:
    batch_size: 50
    parallel_processing: true
    backup_original: true
    validation_on_conversion: true
    
  stage3_research:
    research_timeout: 60
    concurrent_requests: 3
    cache_results: true
    cache_duration_days: 30
    research_templates:
      density: "Provide the density range for {material_name} in {category} category. Include minimum and maximum values in g/cm³."
      thermal_conductivity: "What is the thermal conductivity range for {material_name}? Provide values in W/m·K."
      
  stage4_validation:
    validation_methods:
      - "source_triangulation"
      - "statistical_analysis" 
      - "category_consistency"
      - "physical_constraints"
    consensus_algorithm: "weighted_average"
    disagreement_threshold: 0.3
    
  stage5_quality_assurance:
    quality_gates:
      - name: "completeness_check"
        threshold: 0.95
        blocking: true
      - name: "accuracy_validation"
        threshold: 0.90
        blocking: true
      - name: "consistency_analysis"
        threshold: 0.85
        blocking: false
    statistical_tests:
      - "normality_test"
      - "outlier_detection"
      - "correlation_analysis"
      
  stage6_production:
    deployment_strategy: "blue_green"
    staging_validation: true
    rollback_enabled: true
    backup_retention_days: 30
    health_check_endpoints:
      - "/api/materials/health"
      - "/api/properties/validate"
    
  stage7_monitoring:
    monitoring_interval: 300  # seconds
    alert_channels:
      - "email"
      - "slack"
    dashboard_refresh: 60     # seconds

# Data source priorities and configurations
data_sources:
  nist_materials_db:
    url: "https://materialsdata.nist.gov/api"
    priority: 1
    confidence_multiplier: 1.2
    timeout: 30
    
  asm_handbook:
    priority: 1
    confidence_multiplier: 1.1
    access_method: "api"
    
  crc_handbook:
    priority: 2
    confidence_multiplier: 1.0
    access_method: "lookup_table"
    
  materials_project:
    url: "https://materialsproject.org/api"
    priority: 2
    confidence_multiplier: 0.9
    
  literature_search:
    priority: 3
    confidence_multiplier: 0.8
    max_results: 10

# Property-specific validation rules
property_validation:
  density:
    physical_constraints:
      min: 0.1      # g/cm³ (aerogels)
      max: 25.0     # g/cm³ (osmium)
    category_constraints:
      metal: {min: 0.5, max: 25.0}
      ceramic: {min: 1.8, max: 15.7}
      wood: {min: 0.3, max: 1.2}
      plastic: {min: 0.9, max: 2.3}
      
  melting_point:
    physical_constraints:
      min: -272     # °C (absolute minimum practical)
      max: 4000     # °C (practical maximum for materials)
    category_constraints:
      metal: {min: -39, max: 3422}    # Mercury to Tungsten
      ceramic: {min: 1000, max: 4000}
      plastic: {min: 80, max: 400}
      
  thermal_conductivity:
    physical_constraints:
      min: 0.001    # W/m·K (aerogels)
      max: 450      # W/m·K (diamond)
    category_constraints:
      metal: {min: 6.0, max: 429.0}
      ceramic: {min: 0.03, max: 2000.0}
      
  hardness:
    physical_constraints:
      min: 0.01     # Mohs scale
      max: 10.0     # Diamond = 10 Mohs
    category_constraints:
      metal: {min: 0.5, max: 3500}    # HV scale
      ceramic: {min: 1.0, max: 10.0}  # Mohs scale

# Error handling and retry policies
error_handling:
  max_retries: 3
  retry_backoff: "exponential"  # linear, exponential, fixed
  timeout_handling: "graceful_degradation"
  error_logging: "comprehensive"
  
  critical_errors:
    - "database_connection_failed"
    - "api_quota_exceeded"
    - "validation_system_down"
    
  recoverable_errors:
    - "temporary_network_failure"
    - "rate_limit_exceeded"
    - "partial_data_unavailable"

# Performance and resource management
performance:
  max_concurrent_operations: 5
  memory_limit_mb: 2048
  disk_space_limit_gb: 10
  cpu_cores: 4
  batch_processing: true
  batch_size: 25

# Security and access control
security:
  api_key_rotation_days: 90
  data_encryption: true
  audit_logging: true
  access_control: "role_based"
  
  roles:
    pipeline_admin:
      permissions: ["read", "write", "execute", "configure"]
    data_researcher:
      permissions: ["read", "research", "validate"]
    quality_reviewer:
      permissions: ["read", "review", "approve"]

# Notification and alerting
notifications:
  email:
    enabled: true
    smtp_server: "smtp.gmail.com"
    recipients:
      - "data-team@company.com"
      - "quality-team@company.com"
      
  slack:
    enabled: true
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channels:
      - "#data-quality"
      - "#material-properties"
      
  alert_conditions:
    critical:
      - "pipeline_failure"
      - "data_corruption_detected"
      - "validation_failure_rate > 0.1"
      
    warning:
      - "quality_threshold_missed"
      - "research_confidence_low"
      - "unusual_property_values"

# Backup and recovery
backup:
  enabled: true
  frequency: "daily"
  retention_days: 30
  backup_location: "backups/"
  compression: true
  verification: true
  
  recovery:
    automatic_rollback: true
    rollback_triggers:
      - "validation_failure_rate > 0.2"
      - "system_health_critical"
    
# Integration settings
integration:
  materials_yaml: "data/Materials.yaml"
  categories_yaml: "data/Categories.yaml"
  frontmatter_directory: "content/components/frontmatter/"
  
  api_endpoints:
    health_check: "/api/pipeline/health"
    status: "/api/pipeline/status"
    trigger: "/api/pipeline/trigger"
    results: "/api/pipeline/results"
    
  external_systems:
    next_js_deployment: true
    api_cache_invalidation: true
    documentation_updates: true

# Logging configuration
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  rotation: "daily"
  retention_days: 90
  
  loggers:
    pipeline: "INFO"
    research: "DEBUG"
    validation: "INFO"
    quality: "INFO"
    production: "WARNING"