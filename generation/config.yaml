# Generation Configuration
# Single-pass production generation

# Core Intensity Sliders (1-10 scale)
author_voice_intensity: 5
personality_intensity: 5
engagement_style: 5
emotional_intensity: 5
technical_language_intensity: 5
context_specificity: 5
sentence_rhythm_variation: 5
imperfection_tolerance: 5
structural_predictability: 5
ai_avoidance_intensity: 5
humanness_intensity: 5
human_score_learning_target: 50
use_modular_parameters: false

# Quality Gate Settings (used for post-generation analysis)
# Thresholds for logging and learning - generation always succeeds
quality_gates:
  realism_threshold: 3.0                 # Minimum realism score for logging
  max_retry_attempts: 5                  # Maximum generation attempts
  voice_authenticity_threshold: 3.0      # Voice authenticity minimum
  tonal_consistency_threshold: 3.0       # Tonal consistency minimum
  winston_threshold: 0.70                # Grok humanness threshold alias (legacy key name)
  require_zero_ai_tendencies: false      # Allow AI patterns
  adaptive_threshold: true               # Learn from 75th percentile of successful content

# Postprocessing command thresholds and scoring
postprocess:
  max_regeneration_attempts: 3
  quality_threshold: 60
  min_content_length_chars: 150
  readability:
    max_avg_sentence_words: 24
    max_avg_word_length: 7.5
  requirements:
    require_not_ai_like: true
    require_zero_ai_issues: true
    require_zero_forbidden_phrases: true
    min_voice_authenticity_score: 60
    require_pattern_found: true
    min_structural_average_score: 50
    require_readability_pass: true
    require_cross_item_variation_pass: true
    require_page_description_clean: true
  selection_weights:
    pattern_count_bonus: 20
    pattern_found_bonus: 10
    forbidden_phrase_penalty: 50
    readability_pass_bonus: 8
    readability_fail_penalty: 12
    readability_violation_penalty: 5
    cross_item_pass_bonus: 6
    cross_item_fail_penalty: 20
    cross_item_near_duplicate_penalty: 8

# Centralized constants for generation/postprocessing/shared services
constants:
  structural_variation:
    cross_item_opening_weight: 0.35
    cross_item_starter_weight: 0.25
    cross_item_trigram_weight: 0.25
    cross_item_length_weight: 0.15
    cross_item_near_duplicate_threshold: 0.80
    author_voice_preservation_threshold: 0.6

  image_prompt_optimizer:
    imagen_4_char_limit: 4096
    imagen_optimal_target: 2400
    imagen_warning_threshold: 3000

  api_helper:
    max_tokens: 150
    temperature: 0.7
    frequency_penalty: 0.0
    presence_penalty: 0.0
    max_retries: 3

  batch_generator:
    tokens_per_material: 500

  research:
    faq_topic_max_tokens: 200
    content_application_max_tokens: 2500
    content_contaminant_max_tokens: 2000
    content_thesaurus_max_tokens: 1500
    ai_research_property_max_tokens: 1000
    ai_research_verification_confidence_threshold: 0.7

  voice_post_processor:
    temperature: 0.4
    batch_faq_max_tokens: 6000
    subtitle_transform_max_tokens: 50

  laser_properties_researcher:
    high_confidence_threshold: 0.85
    acceptable_confidence_threshold: 0.70
    optical_max_tokens: 800
    thermal_max_tokens: 900
    removal_max_tokens: 1000
    parameters_max_tokens: 900
    safety_max_tokens: 1000
    selectivity_max_tokens: 1200

  materials_property_manager:
    yaml_confidence_threshold: 0.85

  sweet_spot_analyzer:
    min_samples: 3
    success_threshold: 0.80

  subjective_evaluator:
    quality_threshold: 7.0
    evaluation_temperature: 0.2
    request_max_tokens: 600

  data_generators:
    context:
      temperature: 0.3
      max_tokens: 100
    power_intensity:
      temperature: 0.3
      max_tokens: 100

  backfill_generators:
    settings_description:
      temperature: 0.7
      max_tokens: 500
      request_delay_seconds: 0.5
    settings_recommendations:
      temperature: 0.7
      max_tokens: 800
      request_delay_seconds: 0.5
    contaminant_description:
      temperature: 0.7
      max_tokens: 500
      request_delay_seconds: 0.5
    contaminant_appearance:
      temperature: 0.6
      max_tokens: 400
      request_delay_seconds: 0.5
    contaminant_compounds:
      temperature: 0.5
      max_tokens: 600
      request_delay_seconds: 0.5
    contaminant_context:
      temperature: 0.5
      max_tokens: 400
      request_delay_seconds: 0.5

  pipeline_process_service:
    environmental_impact_description_max_tokens: 150
    quantified_benefits_max_tokens: 80
    outcome_metric_description_max_tokens: 150

# Evaluation Settings
evaluation:
  temperature: 0.2                       # Low temperature for consistent evaluation
  model: "grok-beta"                     # Evaluation model (Grok for subjective)
  verbose: true                          # Print detailed evaluation output

# Detection settings (required by ProcessingConfig)
detection:
  ai_threshold: 30
  strict_mode_threshold: 25
  high_confidence_threshold: 70
  medium_confidence_threshold: 50
  regenerate_threshold: 70
  revise_threshold: 50
  word_frequency_threshold: 3
  word_frequency_critical: 5
  structural_repetition_threshold: 2
  use_ml_model: false

# Readability settings (required by ProcessingConfig)
readability:
  min_flesch_score: 60.0
  max_flesch_score: 100.0

# API settings (required by ProcessingConfig)
api:
  base_temperature: 0.8
  max_attempts: 5
  retry_temperature_increase: 0.1

# Base Voice Parameters (Before Learning/Adjustment)
# These are the starting baseline - RealismOptimizer adjusts during retry
voice_parameters:
  emotional_tone: 0.3                    # Base: moderate emotion (0.0-1.0)
  opinion_rate: 0.2                      # Base: low opinion frequency (0.0-1.0)
  structural_predictability: 0.5         # Base: moderate structure (0.0-1.0)
  sentence_rhythm_variation: 1.0         # Base: maximum variation (0.0-1.0) - triggers 'varied' rhythm pattern
  imperfection_tolerance: 0.4            # Base: moderate imperfections (0.0-1.0)
  trait_frequency: 0.5                   # Base: moderate personality (0.0-1.0)
  colloquialism_frequency: 0.3           # Base: low casual language (0.0-1.0)
  technical_intensity: 1                 # Base: minimal technical detail (1-3 scale) - reduced jargon

# Centralized domain behavior (no domain-specific branching in code)
domain_generation:
  materials:
    seo_components:
      - "page_title"
      - "meta_description"
    length_control:
      skip_components:
        - "pageDescription"
    normalize_components:
      - "pageDescription"
    field_mappings:
      faq: "operational.expert_answers"
      pageTitle: "page_title"
    author_resolution:
      strategy: "direct"
  contaminants:
    seo_components:
      - "page_title"
      - "meta_description"
    length_control:
      skip_components:
        - "pageDescription"
    normalize_components:
      - "pageDescription"
    field_mappings:
      pageTitle: "page_title"
    author_resolution:
      strategy: "direct"
  settings:
    seo_components:
      - "page_title"
      - "meta_description"
    length_control:
      skip_components:
        - "pageDescription"
    normalize_components:
      - "pageDescription"
    field_mappings:
      pageTitle: "page_title"
    author_resolution:
      strategy: "direct"
  compounds:
    seo_components:
      - "page_title"
      - "meta_description"
    length_control:
      skip_components:
        - "pageDescription"
    normalize_components:
      - "pageDescription"
    field_mappings:
      pageTitle: "page_title"
    author_resolution:
      strategy: "direct"
  applications:
    seo_components:
      - "page_title"
      - "meta_description"
    length_control:
      skip_components:
        - "pageDescription"
        - "relatedMaterials"
        - "contaminatedBy"
    normalize_components:
      - "pageDescription"
    field_mappings:
      pageTitle: "page_title"
    author_resolution:
      strategy: "direct"

field_router:
  field_types:
    materials:
      text:
        - "pageDescription"
        - "pageTitle"
        - "micro"
        - "faq"
        - "contaminatedBy"
        - "relatedMaterials"
        - "industryApplications"
        - "commonChallenges"
        - "removalMethods"
        - "preventionStrategies"
        - "materialCharacteristics"
        - "laserMaterialInteraction"
        - "physicalProperties"
        - "appearanceVariations"
        - "environmentalImpact"
      data:
        - "power_intensity"
        - "context"
    contaminants:
      text:
        - "pageDescription"
        - "pageTitle"
        - "micro"
        - "compounds"
        - "appearance"
        - "producedByMaterials"
        - "relatedContaminants"
        - "detectionMethods"
        - "removalMethods"
        - "preventionStrategies"
        - "healthEffects"
        - "exposureLimits"
        - "ppeRequirements"
        - "emergencyResponse"
        - "continuousMonitoring"
      data:
        - "context"
    settings:
      text:
        - "pageDescription"
        - "pageTitle"
        - "component_summary"
        - "recommendations"
        - "challenges"
        - "industryApplications"
        - "commonChallenges"
        - "operationalConsiderations"
      data: []
    compounds:
      text:
        - "pageDescription"
        - "pageTitle"
        - "health_effects"
        - "exposure_guidelines"
        - "detection_methods"
        - "first_aid"
        - "ppe_requirements"
        - "regulatory_standards"
        - "producedFromContaminants"
        - "relatedCompounds"
        - "healthEffects"
        - "exposureLimits"
        - "ppeRequirements"
        - "emergencyResponse"
        - "storageRequirements"
        - "regulatoryClassification"
        - "reactivity"
      data: []
    applications:
      text:
        - "pageTitle"
        - "pageDescription"
      data: []
  field_aliases:
    materials:
      page_description: "pageDescription"
      description: "pageDescription"
      page_title: "pageTitle"
    contaminants:
      page_description: "pageDescription"
      description: "pageDescription"
      page_title: "pageTitle"
    settings:
      page_description: "pageDescription"
      description: "pageDescription"
      page_title: "pageTitle"
    compounds:
      page_description: "pageDescription"
      description: "pageDescription"
      page_title: "pageTitle"
    applications:
      page_description: "pageDescription"
      description: "pageDescription"
      page_title: "pageTitle"
  data_generators:
    materials:
      power_intensity: "generation.data.power_intensity_generator.PowerIntensityGenerator"
      context: "generation.data.context_generator.ContextGenerator"
    contaminants:
      context: "generation.data.context_generator.ContextGenerator"
    settings: {}
    compounds: {}
    applications: {}

data_generators:
  context:
    prompt_templates:
      materials: |
        Research where {display_name} is typically used and cleaned with lasers.

        Analyze:
        1. Indoor vs outdoor usage patterns
        2. Industrial settings and applications
        3. Marine/coastal exposure likelihood

        Provide ONLY a structured assessment in this format:
        indoor: [high/medium/low]
        outdoor: [high/medium/low]
        industrial: [high/medium/low]
        marine: [high/medium/low]

        Respond with ONLY the four lines above, no additional text.
      contaminants: |
        Research where {display_name} typically forms and which environments it is most common in.

        Analyze:
        1. Indoor vs outdoor occurrence
        2. Industrial settings prevalence
        3. Marine/coastal exposure patterns

        Provide ONLY a structured assessment:
        indoor: [high/medium/low/none]
        outdoor: [high/medium/low/none]
        industrial: [high/medium/low/none]
        marine: [high/medium/low/none]

        Respond with ONLY the four lines above, no additional text.
    allowed_values:
      materials:
        - "high"
        - "medium"
        - "low"
      contaminants:
        - "high"
        - "medium"
        - "low"
        - "none"

# (simple_mode section REMOVED - always production mode)

# Voice Intensity Parameters (1-10 scale)
jargon_removal: 7                        # Reduce technical jargon (1=minimal, 10=maximum removal)
professional_voice: 5                    # Professional tone level (1=casual, 10=highly professional)

# DEPRECATED (Dec 29, 2025): Word count parameters removed
# Word counts now defined in prompt files. See docs/08-development/WORD_COUNT_IN_PROMPTS_POLICY.md
# Legacy code accessing length_variation_range or word_count_variation will receive defaults (50%).
length_variation_range: 5                # Default 5/10 (50% variation) for backwards compatibility (valid range: 1-10)

# Length Control Settings (NEW - Jan 9, 2026)
# Smart truncation system for precise word count compliance
length_control:
  enable_smart_truncation: true          # Apply smart truncation to meet word targets (100% accuracy)
  default_target_words: 50               # Fallback target if no prompt guidance found
  tolerance: 0.1                         # Allow 10% overage before aggressive truncation
  preserve_sentences: true               # Prefer sentence boundaries when truncating
  log_truncation: true                   # Display truncation statistics in terminal

# Temperature Variation Range (NEW - Dec 12, 2025)
# Adds randomness to base temperature for each generation
# Base temperature from dynamic_config, then add random variation
# Examples:
#   0.00 = No variation (always base temp)
#   0.05 = ±0.05 variation (base 0.80 → range 0.75-0.85)
#   0.10 = ±0.10 variation (base 0.80 → range 0.70-0.90)
#   0.15 = ±0.15 variation (base 0.80 → range 0.65-0.95)
temperature_variation: 0.15              # ±0.15 for diverse outputs

# Structural Diversity Boost (NEW - Dec 12, 2025)
# Controls how aggressively to vary structural elements
# Higher values = more dramatic differences between generations
# Scale 0.0-1.0:
#   0.0 = Minimal variation (consistent structure)
#   0.5 = Moderate variation (balanced)
#   1.0 = Maximum variation (dramatically different each time)
structural_diversity_factor: 0.8         # High diversity for distinct outputs

# Randomization Targets Configuration
# MOVED TO DOMAIN-SPECIFIC CONFIGS:
# - Materials: domains/materials/config.yaml (structures, property_strategies, warning_placements, length, subtitle_length)
# - Settings: domains/settings/config.yaml (voices, rhythms)
# 
# Shared randomization targets (used across all domains):
randomization_targets:
  # Opening patterns and structural elements
  opening_patterns:
    - "technical_direct"
    - "challenge_focus"
    - "property_emphasis"
    - "comparative"
  
  # Sentence structures for variety
  structures:
    simple:
      label: "Simple Structure"
      description: "Single independent clause with clear, direct expression"
      probability: 0.3
    compound:
      label: "Compound Structure"
      description: "Two independent clauses joined by coordinating conjunction"
      probability: 0.3
    complex:
      label: "Complex Structure"
      description: "Independent clause with dependent clause for depth"
      probability: 0.25
    compound_complex:
      label: "Compound-Complex Structure"
      description: "Multiple clauses combining coordination and subordination"
      probability: 0.15
  
  # Rhythm patterns for sentence variation
  rhythms:
    varied:
      label: "Varied Rhythm"
      description: "Mix of short and long sentences for dynamic flow"
    balanced:
      label: "Balanced Rhythm"
      description: "Consistent sentence lengths for steady pacing"
    short_punch:
      label: "Short Punchy"
      description: "Brief, impactful sentences for direct communication"
    flowing:
      label: "Flowing Rhythm"
      description: "Longer sentences with natural, continuous movement"

  # Property integration strategies
  property_strategies:
    technical_focus:
      label: "Technical Focus"
      description: "Emphasize specific technical properties and measurements"
    comparative:
      label: "Comparative Approach"
      description: "Compare properties to other materials or standards"
    practical_emphasis:
      label: "Practical Emphasis"
      description: "Focus on real-world applications and use cases"
    balanced_integration:
      label: "Balanced Integration"
      description: "Mix technical details with practical applications"

  # Warning placement strategies
  warning_placements:
    upfront:
      label: "Upfront Warnings"
      description: "Place important warnings and considerations early"
    contextual:
      label: "Contextual Warnings"
      description: "Integrate warnings within relevant technical context"
    summary:
      label: "Summary Warnings"
      description: "Consolidate key warnings at the end"
    distributed:
      label: "Distributed Warnings"
      description: "Spread warnings throughout content naturally"
  
  # Voice intensities (1-10 scale)
  voice_intensities:
    - 1
    - 2
    - 3
    - 4
    - 5
    - 6
    - 7
    - 8
    - 9
    - 10
  
# Grok Humanness Database
winston_feedback_db_path: "z-beam.db"    # SQLite database path for humanness evaluations (legacy key name)

# Component Extraction Strategies
# DEFAULT: raw (return text as-is) for most components
# EXCEPTIONS: Specialized extraction for specific formats
component_extraction_defaults:
  default_strategy: raw                  # Return text as-is (covers 90% of components)

# Shared Domain Validation Defaults (NEW - Jan 13, 2026)
# All domains inherit these unless overridden
shared_domain_validation:
  require_author: true
  require_slug: true
  min_description_words: 30
  max_description_words: 200

# Override extraction only for special cases:
component_extraction:
  micro:
    extraction_strategy: before_after   # Extract before/after paragraphs
  micro_before_after:
    extraction_strategy: before_after   # Extract before/after paragraphs
  faq:
    extraction_strategy: json_list      # Parse as JSON array

# Data sources (required by ProcessingConfig)
data_sources:
  materials_yaml: data/materials/Materials.yaml
  categories_yaml: data/materials/Categories.yaml

# Output settings (required by ProcessingConfig)
output:
  frontmatter_dir: ../z-beam/frontmatter
  backup_dir: output/backups/frontmatter
  create_backup: true

# Domain Configuration (Consolidated from domains/*/config.yaml - Jan 7, 2026)
# Defines data locations and frontmatter naming for each domain
domains:
  materials:
    data_path: "data/materials/Materials.yaml"
    data_root_key: "materials"
    frontmatter_pattern: "{slug}-laser-cleaning.yaml"
  
  contaminants:
    data_path: "data/contaminants/contaminants.yaml"
    data_root_key: "contaminants"
    frontmatter_pattern: "{slug}-contamination.yaml"
  
  compounds:
    data_path: "data/compounds/Compounds.yaml"
    data_root_key: "compounds"
    frontmatter_pattern: "{slug}-compound.yaml"
  
  settings:
    data_path: "data/settings/Settings.yaml"
    data_root_key: "settings"
    frontmatter_pattern: "{slug}-settings.yaml"

# Dynamic Calculation Parameters
# Zero hardcoded values policy: All calculation factors configured here
dynamic_calculations:
  component_temperature_overrides:
    research: 0.3
  # Completion detection (prevent truncation)
  completion:
    incomplete_patterns:
      - "\\s+$"                    # Trailing whitespace
      - "[^.!?]$"                 # No ending punctuation
      - "\\band\\s*$"              # Ends with "and"
      - "\\bto\\s*$"               # Ends with "to"
      - "\\bthat\\s*$"             # Ends with "that"
      - "\\bthe\\s*$"              # Ends with "the"
    max_retry_attempts: 3        # Try up to 3 times for completion
    token_increases: [650, 800, 1000]  # Very high token limits - effectively no limit
  
  # Token calculation (NO MULTIPLIER - direct word to token conversion)
  token_conversion:
    words_to_tokens_ratio: 1.3           # Tokens per word approximation
    # REMOVED: multiplier_min/max (was causing double-conversion)
  
  # API penalty ranges based on humanness_intensity (1-10)
  penalties:
    low_humanness:                       # humanness 1-3
      frequency: 0.0
      presence: 0.0
    medium_humanness:                    # humanness 4-7
      frequency_max: 0.6                 # Scale 0.0 to this
      presence_max: 0.6
    high_humanness:                      # humanness 8-10
      frequency_min: 0.6                 # Start from this
      frequency_max: 1.2                 # Scale to this
      presence_min: 0.6
      presence_max: 1.2
  
  # Retry behavior ranges
  retry:
    attempts_min: 3
    attempts_max: 7
    temp_increase_min: 0.05
    temp_increase_max: 0.15
  
  # Threshold adjustments
  thresholds:
    detection_adjustment_range: 15       # ±15 from base
    detection_min: 20
    detection_max: 60
    confidence_adjustment_range: 10      # ±10 from base
    readability_adjustment_range: 10     # ±10 from base
